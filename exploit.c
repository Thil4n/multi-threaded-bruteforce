#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <sys/time.h>

#define MAX_PASSWORD_LEN 8

int main()
{
    char password[7];
    int found = 0;
    struct timeval start, end;
    int i;

    gettimeofday(&start, NULL);

    for (i = 0; i <= 9999999; i++)
    {
        sprintf(password, "%05d", i);

        printf("%05d\n", i);

        pid_t pid = fork();

        if (pid == -1)
        {
            perror("fork");
            return 1;
        }
        else if (pid == 0)
        {
            char *args[] = {"./prog", password, NULL};
            execv(args[0], args);

            perror("execv");
            exit(1);
        }
        else
        {
            int status;
            waitpid(pid, &status, 0);

            if (WIFEXITED(status) && WEXITSTATUS(status) == 0)
            {
                gettimeofday(&end, NULL);
                printf("Password found: %s\n", password);
                found = 1;
                break;
            }
        }

        if (found)
        {
            break;
        }
    }

    if (!found)
    {
        gettimeofday(&end, NULL);
        printf("Password not found.\n");
    }

    double elapsed_time = (end.tv_sec - start.tv_sec) + (end.tv_usec - start.tv_usec) / 1e6;
    int total_tries = found ? i + 1 : 10000000;
    double tries_per_second = total_tries / elapsed_time;

    printf("Time taken: %.6f seconds\n", elapsed_time);
    printf("Tries per second: %.6f\n", tries_per_second);

    return 0;
}